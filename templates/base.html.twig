<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}JO PARIS 2024{% endblock %}</title>
        <link rel="icon" type="image/png" href="{{ asset('images/Logo_Olympique_JO.png') }}">
        
        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
        
        <link rel="stylesheet" href="{{ asset('css/styles.css') }}">
        {% block stylesheets %}{% endblock %}

    </head>
    <body>
        <header>
            <nav class="navbar">
                <div class="navbar-left">
                    <a href="{{ path('homepage') }}" class="d-flex align-items-center text-decoration-none text-dark">
                        <img src="{{ asset('/images/Logo_Olympique_JO.png') }}" alt="Anneaux olympiques" class="logo-rings">
                        <span class="site-title ms-2">JO PARIS 2024</span>
                    </a>
                </div>
                <ul class="nav-menu">
                    <li><a href="/">Accueil</a></li>
                    <li><a href="/#sports">Les √âpreuves</a></li>
                    <li><a href="/boutique">Boutique</a></li>
                </ul>
                <div class="navbar-end">
                    <div class="cart">
                        <a href="/panier">
                            {% if cart_count > 0 %}
                                <span class="cart-count">{{ cart_count }}</span>
                            {% endif %}
                            <img src="{{ asset('/images/cart.svg') }}" alt="Panier" class="cart-icon">
                        </a>
                    </div>
                    <div class="navbar-right hover-group">
                        {% if app.user %}
                            <div class="user-logged">
                                <button class="user-toggle" id="userToggleBtn">
                                    <img src="{{ asset('/images/user.png') }}" class="user-icon">
                                    {{ app.user.username }}
                                    <i class="fas fa-chevron-down"></i>
                                </button>

                                <ul class="user-dropdown-content" id="userDropdownContent">
                                    <li><a href="{{ path('ticket_list') }}">üéü Mes Tickets</a></li>
                                    <li><a href="{{ path('app_logout') }}">üîì D√©connexion</a></li>
                                    {% if 'ROLE_ADMIN' in app.user.roles %}
                                        <li><a href="{{ path('admin') }}">‚öôÔ∏è Menu Admin</a></li>
                                    {% endif %}
                                </ul>
                            </div>
                        {% else %}
                            <a href="{{ path('app_login') }}">
                                <img src="{{ asset('/images/user.png') }}" class="user-icon">
                            </a>
                            <a href="{{ path('app_login') }}" class="btn-connect">Se connecter</a>
                        {% endif %}
                    </div>
                </div>
            </nav>
        </header>


        <main>
            {% block body %}{% endblock %}
        </main>

        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <img src="{{ asset('images/Logo_Olympique_JO.png') }}" alt="Logo JO Paris 2024" class="footer-logo">
                </div>
                <nav class="footer-nav">
                    <a href="/#sports">Les √âpreuves</a>
                    <a href="/boutique">Boutique</a>
                </nav>
            </div>
        </footer>

        <!-- Modal Bootstrap -->
        <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cartModalLabel">Produit ajout√© au panier üõí</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                    </div>
                    <div class="modal-body">
                        Votre offre a bien √©t√© ajout√©e au panier.
                    </div>
                    <div class="modal-footer">
                        <a href="{{ path('app_offer_index') }}" class="btn btn-outline-primary">Retourner √† la boutique</a>
                        <a href="{{ path('cart_index') }}" class="btn btn-primary">Voir le panier</a>
                    </div>
                </div>
            </div>
        </div>

        {% block javascripts %}
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

            
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    {% for _ in app.flashes('cart_added') %}
                        var cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
                        cartModal.show();
                    {% endfor %}
                });
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const toggleBtn = document.getElementById('userToggleBtn');
                    const dropdown = document.getElementById('userDropdownContent');

                    toggleBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); // √©viter la propagation du clic
                        dropdown.classList.toggle('active');
                    });

                    // Ferme le menu si clic en dehors
                    document.addEventListener('click', (e) => {
                        if (!dropdown.contains(e.target) && !toggleBtn.contains(e.target)) {
                            dropdown.classList.remove('active');
                        }
                    });
                });
            </script>

        {% endblock %}

    </body>
</html>
